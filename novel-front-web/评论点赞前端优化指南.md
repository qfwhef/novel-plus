# è¯„è®ºç‚¹èµå‰ç«¯ä¼˜åŒ–æŒ‡å—

## ä¿®æ”¹å†…å®¹

å°†åŸæ¥çš„ä¸¤ä¸ª API è°ƒç”¨ï¼ˆç‚¹èµã€å–æ¶ˆç‚¹èµï¼‰æ”¹ä¸ºè°ƒç”¨ä¸€ä¸ªç»Ÿä¸€æ¥å£ã€‚

---

## å·²å®Œæˆçš„ä¿®æ”¹

### 1. API æ–‡ä»¶å·²æ›´æ–°

**æ–‡ä»¶**: `src/api/like.js`

å·²æ·»åŠ æ–°çš„ç»Ÿä¸€æ¥å£ï¼š
```javascript
/**
 * åˆ‡æ¢ç‚¹èµçŠ¶æ€ï¼ˆæ¨èä½¿ç”¨ï¼‰
 * @param {number} commentId - è¯„è®ºID
 * @param {boolean} liked - æ˜¯å¦ç‚¹èµï¼ˆtrue-ç‚¹èµï¼Œfalse-å–æ¶ˆç‚¹èµï¼‰
 */
export function toggleCommentLike(commentId, liked) {
  return request.post('/front/comment/like', {
    commentId,
    liked
  });
}
```

æ—§æ¥å£ä¿ç•™ä½†æ ‡è®°ä¸º `@deprecated`ï¼Œä¿è¯å…¼å®¹æ€§ã€‚

---

## éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨æ–°æ¥å£ï¼ˆæ¨èï¼‰

å¦‚æœä½ çš„ `Book.vue` æˆ–å…¶ä»–ç»„ä»¶ä¸­æœ‰ç‚¹èµåŠŸèƒ½ï¼ŒæŒ‰ä»¥ä¸‹æ–¹å¼ä¿®æ”¹ï¼š

#### ä¿®æ”¹å‰
```javascript
import { likeComment, unlikeComment } from '@/api/like';

// ç‚¹èµæ–¹æ³•
async toggleLike(commentId) {
  if (!this.uid) {
    ElMessage.warning('è¯·å…ˆç™»å½•');
    return;
  }
  
  try {
    if (this.likeStatus[commentId]) {
      // å–æ¶ˆç‚¹èµ
      await unlikeComment(commentId);
      this.likeStatus[commentId] = false;
      // æ›´æ–°ç‚¹èµæ•°é‡
      const comment = this.newestComments.comments.find(c => c.id === commentId);
      if (comment) {
        comment.likeCount = Math.max(0, (comment.likeCount || 0) - 1);
      }
      ElMessage.success('å·²å–æ¶ˆç‚¹èµ');
    } else {
      // ç‚¹èµ
      await likeComment(commentId);
      this.likeStatus[commentId] = true;
      // æ›´æ–°ç‚¹èµæ•°é‡
      const comment = this.newestComments.comments.find(c => c.id === commentId);
      if (comment) {
        comment.likeCount = (comment.likeCount || 0) + 1;
      }
      ElMessage.success('ç‚¹èµæˆåŠŸ');
    }
  } catch (error) {
    console.error('ç‚¹èµæ“ä½œå¤±è´¥:', error);
    ElMessage.error('æ“ä½œå¤±è´¥');
  }
}
```

#### ä¿®æ”¹å
```javascript
import { toggleCommentLike } from '@/api/like';

// ç‚¹èµæ–¹æ³•ï¼ˆæ›´ç®€æ´ï¼‰
async toggleLike(commentId) {
  if (!this.uid) {
    ElMessage.warning('è¯·å…ˆç™»å½•');
    return;
  }
  
  try {
    // è®¡ç®—æ–°çš„ç‚¹èµçŠ¶æ€
    const newLikedState = !this.likeStatus[commentId];
    
    // è°ƒç”¨ç»Ÿä¸€æ¥å£
    await toggleCommentLike(commentId, newLikedState);
    
    // æ›´æ–°æœ¬åœ°çŠ¶æ€
    this.likeStatus[commentId] = newLikedState;
    
    // æ›´æ–°ç‚¹èµæ•°é‡
    const comment = this.newestComments.comments.find(c => c.id === commentId);
    if (comment) {
      comment.likeCount = newLikedState 
        ? (comment.likeCount || 0) + 1 
        : Math.max(0, (comment.likeCount || 0) - 1);
    }
    
    // æç¤ºæ¶ˆæ¯
    ElMessage.success(newLikedState ? 'ç‚¹èµæˆåŠŸ' : 'å·²å–æ¶ˆç‚¹èµ');
  } catch (error) {
    console.error('ç‚¹èµæ“ä½œå¤±è´¥:', error);
    ElMessage.error(error.response?.data?.message || 'æ“ä½œå¤±è´¥');
  }
}
```

---

### æ–¹æ¡ˆ 2ï¼šä¸ä¿®æ”¹ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰

å¦‚æœæš‚æ—¶ä¸æƒ³ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œ**ä¸éœ€è¦åšä»»ä½•æ”¹åŠ¨**ï¼

æ—§æ¥å£ä»ç„¶å¯ç”¨ï¼š
- `likeComment(commentId)` - ç‚¹èµ
- `unlikeComment(commentId)` - å–æ¶ˆç‚¹èµ

åç«¯å·²ä¿ç•™è¿™ä¸¤ä¸ªæ¥å£ï¼Œåªæ˜¯æ ‡è®°ä¸º `@Deprecated`ã€‚

---

## å®Œæ•´ç¤ºä¾‹

### Vue 3 Composition API ç¤ºä¾‹

```vue
<template>
  <div class="comment-item">
    <div class="comment-content">{{ comment.commentContent }}</div>
    <div class="comment-actions">
      <button 
        @click="handleLikeClick" 
        :class="{ 'liked': isLiked }"
        class="like-button"
      >
        <i :class="isLiked ? 'icon-liked' : 'icon-like'"></i>
        {{ likeCount }}
      </button>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import { toggleCommentLike } from '@/api/like';
import { ElMessage } from 'element-plus';
import { useUserStore } from '@/stores/user';

const props = defineProps({
  comment: {
    type: Object,
    required: true
  }
});

const userStore = useUserStore();
const isLiked = ref(props.comment.isLiked || false);
const likeCount = ref(props.comment.likeCount || 0);

const handleLikeClick = async () => {
  if (!userStore.isLoggedIn) {
    ElMessage.warning('è¯·å…ˆç™»å½•');
    return;
  }
  
  const newLikedState = !isLiked.value;
  
  try {
    await toggleCommentLike(props.comment.id, newLikedState);
    
    // æ›´æ–°æœ¬åœ°çŠ¶æ€
    isLiked.value = newLikedState;
    likeCount.value += newLikedState ? 1 : -1;
    
    ElMessage.success(newLikedState ? 'ç‚¹èµæˆåŠŸ' : 'å·²å–æ¶ˆç‚¹èµ');
  } catch (error) {
    console.error('ç‚¹èµæ“ä½œå¤±è´¥:', error);
    ElMessage.error('æ“ä½œå¤±è´¥');
  }
};
</script>

<style scoped>
.like-button {
  cursor: pointer;
  border: none;
  background: none;
  padding: 4px 8px;
  border-radius: 4px;
  transition: all 0.3s;
}

.like-button:hover {
  background-color: #f5f5f5;
}

.like-button.liked {
  color: #ed4259;
}

.icon-like::before {
  content: 'ğŸ‘';
}

.icon-liked::before {
  content: 'ğŸ‘';
}
</style>
```

---

## ä¼˜åŠ¿å¯¹æ¯”

### ä½¿ç”¨æ–°æ¥å£çš„ä¼˜åŠ¿

1. **ä»£ç æ›´ç®€æ´**
   ```javascript
   // æ—§æ–¹å¼ï¼šéœ€è¦åˆ¤æ–­è°ƒç”¨å“ªä¸ªæ¥å£
   if (liked) {
     await likeComment(id);
   } else {
     await unlikeComment(id);
   }
   
   // æ–°æ–¹å¼ï¼šä¸€ä¸ªæ¥å£æå®š
   await toggleCommentLike(id, liked);
   ```

2. **é€»è¾‘æ›´æ¸…æ™°**
   - ä¸éœ€è¦ if-else åˆ¤æ–­
   - çŠ¶æ€ç®¡ç†æ›´ç®€å•

3. **æ˜“äºç»´æŠ¤**
   - åªéœ€è¦ç»´æŠ¤ä¸€ä¸ªæ¥å£
   - å‡å°‘ä»£ç é‡å¤

4. **æ€§èƒ½ä¸€è‡´**
   - å“åº”æ—¶é—´ç›¸åŒ
   - ä¸å½±å“ç”¨æˆ·ä½“éªŒ

---

## æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•æ–°æ¥å£

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•
import { toggleCommentLike } from '@/api/like';

// æµ‹è¯•ç‚¹èµ
await toggleCommentLike(1001, true);

// æµ‹è¯•å–æ¶ˆç‚¹èµ
await toggleCommentLike(1001, false);
```

### 2. æµ‹è¯•æ—§æ¥å£ï¼ˆå…¼å®¹æ€§ï¼‰

```javascript
import { likeComment, unlikeComment } from '@/api/like';

// æµ‹è¯•ç‚¹èµ
await likeComment(1001);

// æµ‹è¯•å–æ¶ˆç‚¹èµ
await unlikeComment(1001);
```

ä¸¤ç§æ–¹å¼éƒ½åº”è¯¥æ­£å¸¸å·¥ä½œã€‚

---

## è¿ç§»å»ºè®®

### æ¸è¿›å¼è¿ç§»

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šæ–°åŠŸèƒ½ä½¿ç”¨æ–°æ¥å£
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šé€æ­¥é‡æ„æ—§ä»£ç 
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šå®Œå…¨ç§»é™¤æ—§æ¥å£è°ƒç”¨

### æ—¶é—´å®‰æ’

- æ–°åŠŸèƒ½ç«‹å³ä½¿ç”¨æ–°æ¥å£
- æ—§ä»£ç å¯ä»¥ä¿æŒä¸å˜
- ä¸‹ä¸ªç‰ˆæœ¬ç»Ÿä¸€é‡æ„

---

## æ€»ç»“

### å·²å®Œæˆ
- âœ… API æ–‡ä»¶å·²æ›´æ–°
- âœ… æ–°æ¥å£å·²æ·»åŠ 
- âœ… æ—§æ¥å£ä¿ç•™å…¼å®¹

### éœ€è¦åšçš„
- ğŸ“ æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æ–¹æ¡ˆ 1 æˆ–æ–¹æ¡ˆ 2
- ğŸ“ å¦‚æœé€‰æ‹©æ–¹æ¡ˆ 1ï¼Œä¿®æ”¹ç»„ä»¶ä¸­çš„ç‚¹èµæ–¹æ³•
- ğŸ“ æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸

### å»ºè®®
- ğŸ’¡ æ–°åŠŸèƒ½ä½¿ç”¨æ–°æ¥å£
- ğŸ’¡ æ—§ä»£ç å¯ä»¥ä¸æ”¹ï¼ˆå…¼å®¹ï¼‰
- ğŸ’¡ æœ‰æ—¶é—´å†ç»Ÿä¸€é‡æ„

**å‰ç«¯ä¿®æ”¹æŒ‡å—å®Œæˆï¼** âœ…

# è¯„è®ºç‚¹èµå‰ç«¯å®ç°æŒ‡å—

## 1. åˆ›å»º API æ–‡ä»¶

åˆ›å»º `src/api/like.js`:

```javascript
import request from '../utils/request'

// ç‚¹èµè¯„è®º
export function likeComment(commentId) {
  return request.post(`/front/comment/${commentId}/like`);
}

// å–æ¶ˆç‚¹èµ
export function unlikeComment(commentId) {
  return request.delete(`/front/comment/${commentId}/like`);
}

// è·å–ç‚¹èµæ•°é‡
export function getLikeCount(commentId) {
  return request.get(`/front/comment/${commentId}/like/count`);
}

// è·å–ç‚¹èµçŠ¶æ€
export function getLikeStatus(commentId) {
  return request.get(`/front/comment/${commentId}/like/status`);
}

// æ‰¹é‡è·å–ç‚¹èµçŠ¶æ€
export function batchGetLikeStatus(commentIds) {
  return request.post('/front/comment/like/batch-status', commentIds);
}
```

## 2. ä¿®æ”¹ Book.vue

åœ¨è¯„è®ºåˆ—è¡¨ä¸­æ·»åŠ ç‚¹èµæŒ‰é’®ï¼š

```vue
<template>
  <!-- åœ¨è¯„è®ºçš„ other éƒ¨åˆ†æ·»åŠ ç‚¹èµæŒ‰é’® -->
  <li class="other cf">
    <span class="time fl">{{ item.commentTime }}</span>
    <span class="fr">
      <!-- ç‚¹èµæŒ‰é’® -->
      <a
        href="javascript:void(0);"
        @click="toggleLike(item.id)"
        class="zan"
        :class="{ 'liked': likeStatus[item.id] }"
      >
        <i :class="likeStatus[item.id] ? 'icon-liked' : 'icon-like'"></i>
        èµ({{ item.likeCount || 0 }})
      </a>
      |
      <a
        href="javascript:void(0);"
        @click="toggleReplyInput(item.id)"
        class="zan"
      >
        å›å¤({{ item.replyCount || 0 }})
      </a>
      <!-- å…¶ä»–æŒ‰é’®... -->
    </span>
  </li>
</template>

<script>
import { likeComment, unlikeComment, batchGetLikeStatus } from '@/api/like';

export default {
  data() {
    return {
      likeStatus: {}, // ç‚¹èµçŠ¶æ€ { commentId: true/false }
    };
  },
  methods: {
    // åŠ è½½è¯„è®ºæ—¶åŒæ—¶åŠ è½½ç‚¹èµçŠ¶æ€
    async loadNewestComments(bookId) {
      const { data } = await listNewestComments({ bookId: bookId });
      this.newestComments = data;
      
      // åŠ è½½ç‚¹èµçŠ¶æ€
      if (this.uid && data.comments && data.comments.length > 0) {
        const commentIds = data.comments.map(c => c.id);
        const { data: likeStatusData } = await batchGetLikeStatus(commentIds);
        this.likeStatus = likeStatusData;
      }
      
      // è‡ªåŠ¨åŠ è½½å›å¤...
    },
    
    // åˆ‡æ¢ç‚¹èµçŠ¶æ€
    async toggleLike(commentId) {
      if (!this.uid) {
        ElMessage.warning('è¯·å…ˆç™»å½•');
        return;
      }
      
      try {
        if (this.likeStatus[commentId]) {
          // å–æ¶ˆç‚¹èµ
          await unlikeComment(commentId);
          this.likeStatus[commentId] = false;
          // æ›´æ–°ç‚¹èµæ•°é‡
          const comment = this.newestComments.comments.find(c => c.id === commentId);
          if (comment) {
            comment.likeCount = Math.max(0, (comment.likeCount || 0) - 1);
          }
          ElMessage.success('å·²å–æ¶ˆç‚¹èµ');
        } else {
          // ç‚¹èµ
          await likeComment(commentId);
          this.likeStatus[commentId] = true;
          // æ›´æ–°ç‚¹èµæ•°é‡
          const comment = this.newestComments.comments.find(c => c.id === commentId);
          if (comment) {
            comment.likeCount = (comment.likeCount || 0) + 1;
          }
          ElMessage.success('ç‚¹èµæˆåŠŸ');
        }
      } catch (error) {
        console.error('ç‚¹èµæ“ä½œå¤±è´¥:', error);
        ElMessage.error('æ“ä½œå¤±è´¥');
      }
    },
  },
};
</script>

<style scoped>
.zan.liked {
  color: #ed4259;
}

.icon-like::before {
  content: 'ğŸ‘';
}

.icon-liked::before {
  content: 'ğŸ‘';
  color: #ed4259;
}
</style>
```

## 3. æ ·å¼ä¼˜åŒ–

å¯ä»¥ä½¿ç”¨ Font Awesome æˆ–å…¶ä»–å›¾æ ‡åº“æ¥ç¾åŒ–ç‚¹èµæŒ‰é’®ï¼š

```css
.like-button {
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  border-radius: 4px;
  transition: all 0.3s;
}

.like-button:hover {
  background-color: #f5f5f5;
}

.like-button.liked {
  color: #ed4259;
}

.like-button.liked:hover {
  background-color: #ffe6e9;
}
```

## 4. é˜²æŠ–å¤„ç†

ä¸ºäº†é¿å…ç”¨æˆ·å¿«é€Ÿç‚¹å‡»å¯¼è‡´çš„é‡å¤è¯·æ±‚ï¼Œå¯ä»¥æ·»åŠ é˜²æŠ–ï¼š

```javascript
import { debounce } from 'lodash';

export default {
  methods: {
    toggleLike: debounce(async function(commentId) {
      // ç‚¹èµé€»è¾‘...
    }, 300),
  },
};
```

## 5. æµ‹è¯•æ­¥éª¤

1. é‡å¯åç«¯æœåŠ¡
2. åˆ·æ–°å‰ç«¯é¡µé¢
3. ç™»å½•ç”¨æˆ·
4. åœ¨è¯„è®ºåŒºç‚¹å‡»ç‚¹èµæŒ‰é’®
5. éªŒè¯ç‚¹èµæ•°é‡å¢åŠ 
6. å†æ¬¡ç‚¹å‡»å–æ¶ˆç‚¹èµ
7. éªŒè¯ç‚¹èµæ•°é‡å‡å°‘

## å®Œæˆï¼

åŸºç¡€ç‰ˆæœ¬çš„ç‚¹èµåŠŸèƒ½å·²ç»å®ç°ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚åç»­å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ  Redis ç¼“å­˜ã€RabbitMQ å¼‚æ­¥å¤„ç†ç­‰é«˜çº§åŠŸèƒ½ã€‚

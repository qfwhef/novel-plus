# 书架功能实现说明

## 功能概述
本次更新为前端添加了完整的用户书架功能，包括：
1. 导航栏显示"我的书架"入口（仅登录用户可见）
2. 书籍详情页添加"加入书架"/"移出书架"按钮
3. 独立的书架页面，展示用户收藏的所有书籍
4. 支持继续阅读功能（记录上次阅读位置）

## 新增文件

### 1. API接口文件
- `src/api/bookshelf.js` - 书架相关API接口封装

### 2. 页面组件
- `src/views/Bookshelf.vue` - 我的书架页面

### 3. 接口文档
- `novel-plus/doc/接口文档/用户书架接口.md` - 后端接口文档说明

## 修改文件

### 1. 导航栏组件
- `src/components/common/Top.vue`
  - 添加"我的书架"链接（仅登录用户显示）

### 2. 书籍详情页
- `src/views/Book.vue`
  - 添加"加入书架"/"移出书架"按钮
  - 集成书架状态检查逻辑
  - 添加书架操作相关方法

### 3. 路由配置
- `src/router/index.js`
  - 添加书架页面路由：`/user/bookshelf`

## 功能特性

### 1. 导航栏入口
- 位置：顶部导航栏右侧
- 显示条件：用户已登录
- 点击跳转到书架页面

### 2. 书籍详情页操作
- **加入书架按钮**：
  - 显示条件：用户已登录且书籍不在书架中
  - 点击后将书籍添加到书架
  - 成功后按钮变为"移出书架"
  
- **移出书架按钮**：
  - 显示条件：用户已登录且书籍已在书架中
  - 点击后从书架移除该书籍
  - 成功后按钮变为"加入书架"

### 3. 书架页面
- **空状态**：
  - 书架为空时显示提示图片和文字
  - 提供"去首页看看"按钮引导用户浏览
  
- **书籍列表**：
  - 展示书籍封面、名称、作者、简介等信息
  - 每本书提供两个操作按钮：
    - **继续阅读**：跳转到上次阅读位置（如有记录）或第一章
    - **移除**：从书架中移除该书籍（需确认）

## 后端接口说明

### 需要实现的接口

#### 1. 获取书架列表
```
GET /front/user/bookshelf
```
返回数据需包含：bookId, bookName, authorName, picUrl, bookDesc, categoryName, wordCount, preContentId, firstChapterId

#### 2. 添加到书架
```
POST /front/user/bookshelf
Body: { bookId: number }
```

#### 3. 从书架移除
```
DELETE /front/user/bookshelf/{bookId}
```

#### 4. 检查书籍是否在书架
```
GET /front/user/bookshelf/check/{bookId}
```
返回：boolean（true/false）

详细接口文档请查看：`novel-plus/doc/接口文档/用户书架接口.md`

## 数据库表

使用现有的 `user_bookshelf` 表：
```sql
CREATE TABLE `user_bookshelf` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `user_id` bigint unsigned NOT NULL COMMENT '用户ID',
  `book_id` bigint unsigned NOT NULL COMMENT '小说ID',
  `pre_content_id` bigint unsigned DEFAULT NULL COMMENT '上一次阅读的章节内容表ID',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime DEFAULT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_userId_bookId` (`user_id`,`book_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户书架';
```

## 使用说明

### 用户操作流程

1. **添加书籍到书架**：
   - 浏览书籍详情页
   - 点击"加入书架"按钮
   - 系统提示"已加入书架"

2. **查看书架**：
   - 点击顶部导航栏"我的书架"
   - 查看所有收藏的书籍

3. **继续阅读**：
   - 在书架页面点击"继续阅读"
   - 自动跳转到上次阅读位置

4. **移除书籍**：
   - 在书架页面点击"移除"按钮
   - 确认后从书架中移除

## 注意事项

1. 所有书架相关功能都需要用户登录
2. 未登录用户不显示"我的书架"入口和"加入书架"按钮
3. 书架列表按添加时间倒序排列（最新添加的在前）
4. 同一本书不能重复添加到书架（后端需要做唯一性校验）
5. 移除书籍时需要用户确认，避免误操作

## 后续优化建议

1. 添加书架书籍数量显示
2. 支持书架分类管理
3. 添加批量操作功能（批量移除）
4. 支持书架排序（按添加时间、更新时间、书名等）
5. 添加书籍更新提醒功能
6. 支持书架导出/导入功能
